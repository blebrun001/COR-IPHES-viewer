<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dataverse 3D Viewer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
    <script>
      (function () {
        try {
          const storedTheme = window.localStorage.getItem('ui.theme');
          if (storedTheme === 'light' || storedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', storedTheme);
          }
        } catch (error) {
          /* Ignore storage access issues */
        }
      })();
    </script>
    <link rel="stylesheet" href="./public/css/styles.css" />
  </head>
  <body>
    <!-- Application shell grouping header, sidebar, and 3D viewer surface -->
    <div class="app-shell">
      <!-- Header keeps project identity and controls global actions -->
      <header class="top-bar">
        <div class="top-bar__left">
          <button
            id="toggleSidebar"
            type="button"
            class="top-bar__toggle"
            aria-controls="appSidebar"
            aria-expanded="true"
            data-i18n-attr="aria-label:header.toggleSidebar"
          >
            ☰
          </button>
          <h1 class="project-title" data-i18n="header.title">Esqueletos en Línea</h1>
          <p class="project-subtitle" data-i18n="header.subtitle">COR-IPHES 3D Model Viewer</p>
        </div>
        <div class="top-bar__center"></div>
        <div class="top-bar__right">
          <img
            src="./public/ressources/iphes.png"
            data-theme-src-dark="./public/ressources/iphes.png"
            data-theme-src-light="./public/ressources/ipheslight.png"
            alt="IPHES-CERCA logo"
            class="top-bar__logo"
            decoding="async"
          />
        </div>
      </header>
      <div class="app-layout">
        <!-- Sidebar hosts dataset selection, metadata, and external resources -->
        <aside id="appSidebar" class="sidebar" tabindex="-1" aria-expanded="true">
          <section class="sidebar-section selectors-section">
            <div class="sidebar-selectors">
              <div class="selector-group taxonomy-group" id="taxonomyGroup" data-collapsed="false">
                <button
                  id="toggleTaxonomy"
                  class="taxonomy-toggle"
                  type="button"
                  aria-controls="taxonomySelectors"
                  aria-expanded="true"
                >
                  <span class="taxonomy-heading" data-i18n="sidebar.taxonomyHeading">Taxonomy</span>
                  <span class="material-icons taxonomy-toggle__icon" aria-hidden="true">chevron_right</span>
                </button>
                <div
                  id="taxonomySelectors"
                  class="taxonomy-selectors"
                  role="group"
                  aria-labelledby="toggleTaxonomy"
                >
                  <div id="taxonomyLevels" class="taxonomy-levels"></div>
                  <div class="selector-group">
                    <label for="datasetSelect" data-i18n="sidebar.datasetLabel">Specimen</label>
                    <select id="datasetSelect">
                      <option value="" data-i18n="sidebar.datasetLoadingOption">Loading datasets...</option>
                    </select>
                  </div>
                  <div class="selector-group">
                    <label for="modelSelect" data-i18n="sidebar.modelLabel">Anatomical element</label>
                    <select id="modelSelect" disabled>
                      <option value="" data-i18n="sidebar.modelDisabledOption">Select a dataset</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <section class="sidebar-section links-section">
            <div class="sidebar-heading" data-i18n="sidebar.moreInfoHeading">More infos</div>
            <div class="external-links">
              <a
                id="gbifLink"
                class="external-link"
                href="#"
                target="_blank"
                rel="noopener noreferrer"
                hidden
                data-i18n="sidebar.links.gbif"
              >
                Species (GBIF)
              </a>
              <a
                id="coraLink"
                class="external-link"
                href="#"
                target="_blank"
                rel="noopener noreferrer"
                hidden
                data-i18n="sidebar.links.cora"
              >
                Species (CORA-RDR)
              </a>
              <a
                id="uberonLink"
                class="external-link"
                href="#"
                target="_blank"
                rel="noopener noreferrer"
                hidden
                data-i18n="sidebar.links.uberon"
              >
                Anatomical element (OLS UBERON)
              </a>
            </div>
          </section>
          <div class="sidebar-footer">
            <button
              id="optionsButton"
              class="floating-options-button"
              type="button"
              aria-label="Open options"
              data-i18n-attr="aria-label:sidebar.links.options"
            >
              <span class="material-icons floating-options-button__icon" aria-hidden="true">settings</span>
            </button>
            <button
              id="aboutButton"
              type="button"
              class="floating-info-button"
              aria-label="About the project"
              data-i18n-attr="aria-label:sidebar.links.about"
            >
              <span class="material-icons floating-info-button__icon" aria-hidden="true">help_outline</span>
            </button>
          </div>
        </aside>
        <!-- Main area renders the Three.js canvas, status banner, and viewer toolbar -->
        <main class="viewer-area">
          <div id="viewer3D" class="viewer-surface"></div>
          <div id="status" class="viewer-status"></div>
          <div id="measurementOverlay" class="measurement-overlay"></div>
          <img
            src="./public/ressources/cc.png"
            alt="Creative Commons logo"
            class="viewer-watermark"
            decoding="async"
          />
          <div id="viewerToolbar" class="viewer-toolbar" data-collapsed="true">
            <div class="viewer-toolbar__inner">
              <div class="viewer-toolbar__group viewer-toolbar__group--primary">
                <div class="toolbar-buttons toolbar-buttons--primary">
                  <div
                    class="viewer-toolbar__button-group viewer-toolbar__button-group--projection"
                    role="group"
                    aria-label="Projection mode"
                    data-i18n-attr="aria-label:viewer.projection.label"
                  >
                    <button
                      id="projectionModePerspective"
                      type="button"
                      class="viewer-toolbar__button viewer-toolbar__button--toggle viewer-toolbar__button--projection"
                      aria-label="Perspective"
                      data-tooltip="Perspective"
                      data-i18n-attr="aria-label:viewer.projection.perspective,data-tooltip:viewer.projection.perspective"
                      aria-pressed="true"
                    >
                      <span aria-hidden="true" class="material-symbols-outlined viewer-toolbar__icon">token</span>
                    </button>
                    <button
                      id="projectionModeOrthographic"
                      type="button"
                      class="viewer-toolbar__button viewer-toolbar__button--toggle viewer-toolbar__button--projection"
                      aria-label="Orthographic"
                      data-tooltip="Orthographic"
                      data-i18n-attr="aria-label:viewer.projection.orthographic,data-tooltip:viewer.projection.orthographic"
                      aria-pressed="false"
                    >
                      <span aria-hidden="true" class="material-symbols-outlined viewer-toolbar__icon">deployed_code</span>
                    </button>
                  </div>
                  <div
                    class="viewer-toolbar__button-group viewer-toolbar__button-group--orbit"
                    role="group"
                    aria-label="Orbit mode"
                    data-i18n-attr="aria-label:viewer.orbit.label"
                  >
                    <button
                      id="orbitModeUpright"
                      type="button"
                      class="viewer-toolbar__button viewer-toolbar__button--toggle viewer-toolbar__button--orbit"
                      aria-label="Upright orbit"
                      data-tooltip="Upright orbit"
                      data-i18n-attr="aria-label:viewer.orbit.upright,data-tooltip:viewer.orbit.upright"
                      aria-pressed="true"
                    >
                      <span aria-hidden="true" class="material-symbols-outlined viewer-toolbar__icon">arrows_outward</span>
                    </button>
                    <button
                      id="orbitModeFree"
                      type="button"
                      class="viewer-toolbar__button viewer-toolbar__button--toggle viewer-toolbar__button--orbit"
                      aria-label="Free orbit"
                      data-tooltip="Free orbit"
                      data-i18n-attr="aria-label:viewer.orbit.free,data-tooltip:viewer.orbit.free"
                      aria-pressed="false"
                    >
                      <span aria-hidden="true" class="material-symbols-outlined viewer-toolbar__icon">360</span>
                    </button>
                  </div>
                  <button
                    id="captureScreenshot"
                    type="button"
                    class="viewer-toolbar__button"
                    aria-label="Capture"
                    data-tooltip="Capture"
                    data-i18n-attr="aria-label:viewer.buttons.capture,data-tooltip:viewer.buttons.capture"
                  >
                    <span aria-hidden="true" class="material-icons viewer-toolbar__icon">photo_camera</span>
                  </button>
                  <button
                    id="resetView"
                    type="button"
                    class="viewer-toolbar__button"
                    aria-label="Reset View"
                    data-tooltip="Reset View"
                    data-i18n-attr="aria-label:viewer.buttons.resetView,data-tooltip:viewer.buttons.resetView"
                  >
                    <span aria-hidden="true" class="material-icons viewer-toolbar__icon">restart_alt</span>
                  </button>
                </div>
              </div>
              <div class="viewer-toolbar__group viewer-toolbar__group--secondary" id="viewerToolbarSecondary">
                <div class="toolbar-buttons toolbar-buttons--secondary">
                  <button
                    id="toggleTextures"
                    type="button"
                    class="viewer-toolbar__button viewer-toolbar__button--toggle"
                    aria-label="Disable Textures"
                    data-tooltip="Disable Textures"
                  >
                    <span aria-hidden="true" class="material-icons viewer-toolbar__icon">texture</span>
                  </button>
                  <button
                    id="toggleWireframe"
                    type="button"
                    class="viewer-toolbar__button viewer-toolbar__button--toggle"
                    aria-label="Enable Wireframe"
                    data-tooltip="Enable Wireframe"
                  >
                    <span aria-hidden="true" class="material-icons viewer-toolbar__icon">grid_4x4</span>
                  </button>
                  <button
                    id="toggleLighting"
                    type="button"
                    class="viewer-toolbar__button viewer-toolbar__button--toggle"
                    aria-label="Dim Lights"
                    data-tooltip="Dim Lights"
                  >
                    <span aria-hidden="true" class="material-icons viewer-toolbar__icon">wb_incandescent</span>
                  </button>
                  <button
                    id="toggleMeasure"
                    type="button"
                    class="viewer-toolbar__button viewer-toolbar__button--toggle"
                    aria-label="Measure"
                    data-tooltip="Measure"
                  >
                    <span aria-hidden="true" class="material-icons viewer-toolbar__icon">straighten</span>
                  </button>
                  <button
                    id="clearMeasurements"
                    type="button"
                    class="viewer-toolbar__button"
                    aria-label="Clear Measurements"
                    data-tooltip="Clear Measurements"
                    data-i18n-attr="aria-label:viewer.buttons.clearMeasurements,data-tooltip:viewer.buttons.clearMeasurements"
                  >
                    <span aria-hidden="true" class="material-icons viewer-toolbar__icon">delete</span>
                  </button>
                </div>
              </div>
              <button
                id="viewerToolbarToggle"
                class="viewer-toolbar__toggle"
                type="button"
                aria-expanded="false"
                aria-controls="viewerToolbarSecondary"
                data-i18n="viewer.toolbar.showMore"
              >
                More controls
              </button>
            </div>
          </div>
        </main>
      </div>
      <div id="sidebarOverlay" hidden></div>
    </div>

    <!-- Import map resolves Three.js modules when running without a bundler -->
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.161.0/build/three.module.js",
          "three/examples/jsm/": "https://unpkg.com/three@0.161.0/examples/jsm/"
        }
      }
    </script>
    <!-- About dialog content is toggled by about.js for additional context -->
    <dialog id="aboutDialog" class="about-dialog">
      <img
        src="./public/ressources/banner.jpg"
        alt="Esqueletos en Línea banner"
        class="about-banner"
        decoding="async"
        data-i18n-attr="alt:about.bannerAlt"
      />
      <h2 data-i18n="about.title">About the project</h2>
      <section>
        <h3 data-i18n="about.sectionIntro.heading">Project overview</h3>
        <p data-i18n="about.sectionIntro.paragraph1">
          Esqueletos en Línea centralises high-quality 3D models and metadata to help researchers, students, and museum professionals explore zooarchaeological collections online.
        </p>
      </section>
      <section>
        <h3 data-i18n="about.sectionPartners.heading">Institutional partners</h3>
        <ul>
          <li data-i18n="about.sectionPartners.items.item1">Partner Organisation Placeholder 1</li>
          <li data-i18n="about.sectionPartners.items.item2">Partner Organisation Placeholder 2</li>
          <li data-i18n="about.sectionPartners.items.item3">Partner Organisation Placeholder 3</li>
        </ul>
      </section>
      <section>
        <h3 data-i18n="about.sectionContributors.heading">Contributors</h3>
        <ul>
          <li data-i18n="about.sectionContributors.items.item1">Contributor Name Placeholder 1</li>
          <li data-i18n="about.sectionContributors.items.item2">Contributor Name Placeholder 2</li>
          <li data-i18n="about.sectionContributors.items.item3">Contributor Name Placeholder 3</li>
        </ul>
      </section>
      <div class="about-logos" role="group" aria-label="Project partners">
        <img
          src="./public/ressources/iphes.png"
          data-theme-src-dark="./public/ressources/iphes.png"
          data-theme-src-light="./public/ressources/ipheslight.png"
          alt="IPHES-CERCA logo"
        />
        <img src="./public/ressources/cerca.png" alt="CERCA logo" />
        <img src="./public/ressources/fecyt.jpg" alt="FECYT logo" />
        <img src="./public/ressources/ministerio.png" alt="Ministerio de Ciencia e Innovación logo" />
      </div>
      <button
        id="closeAbout"
        type="button"
        class="about-close"
        data-i18n="about.closeButton"
        data-i18n-attr="aria-label:about.closeAria"
      >&times;</button>
    </dialog>
    <dialog id="optionsDialog" class="options-dialog" aria-labelledby="optionsDialogTitle">
      <button
        id="closeOptions"
        type="button"
        class="options-close"
        aria-label="Close options dialog"
      >&times;</button>
      <h2 id="optionsDialogTitle" data-i18n="options.title">Options</h2>
      <div class="options-content">
        <div class="options-section">
          <label
            class="options-language-label"
            for="languageSelect"
            data-i18n="language.selectorLabel"
          >
            Langue&nbsp;:
          </label>
          <select
            id="languageSelect"
            class="options-language-select"
          ></select>
        </div>
        <div class="options-section">
          <label
            class="options-theme-label"
            for="themeSelect"
            data-i18n="options.theme.label"
          >
            Theme&nbsp;:
          </label>
          <select
            id="themeSelect"
            class="options-theme-select"
          >
            <option value="dark" data-i18n="options.theme.dark">Dark</option>
            <option value="light" data-i18n="options.theme.light">Light</option>
          </select>
        </div>
        <div class="options-section">
          <button
            id="reloadDatasets"
            type="button"
            class="options-reload-button options-reload-button--link"
            data-i18n="sidebar.reloadButton"
          >
            Reload specimen list
          </button>
        </div>
      </div>
    </dialog>

    <!-- Entry modules: core viewer bootstrap + supporting UI behaviours -->
    <script type="module" src="./public/js/app.js"></script>
    <script type="module" src="./public/js/about.js"></script>
    <script type="module" src="./public/js/options.js"></script>
    <script type="module" src="./public/js/sidebar.js"></script>
  </body>
</html>
